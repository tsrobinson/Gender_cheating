data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
# model.main = ~ country + offerdg + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
model.main = ~ country,# + offerdg + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
model.main = ~ offerdg ,#+ country + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
model.main = ~ offerdg + country,#+ country + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
model.main = ~ offerdg + country + factor(gender_lab),#+ country + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
model.main = ~ offerdg + country + gender_lab,#+ country + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
df$gender_lab <- factor(df$gender_lab, levels=c("Male","Female"))
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
model.main = ~ offerdg + country + gender_lab,#+ country + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
summary(df$gender_lab)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
model.main = ~ offerdg + country + modes + perform_high,#+ country + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
model.main = ~ offerdg + country + modes,#+ country + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
model.main = ~ offerdg + country,#+ country + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
summary(df$gender_lab)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
model.main = ~ offerdg + country + gender_lab,#+ country + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
df$gender_lab <- factor(df$gender_lab)
##########################################
## Paper: Cheating across gender
## Author code: Denise Laroze
## Additional code: Thomas Robinson
## Year: 2018
##########################################
library(foreign)
library(ggplot2)
library(readstata13)
library(RColorBrewer)
library(rms)
theme_set(theme_bw())
library(plyr)
library(effsize)
library(gridExtra)
library(FindIt)
library(BART)
library(clusterSEs)
library(car)
library(Rmisc)
library(texreg)
library(xtable)
# rm(list=ls())
# setwd("C:/Users/Denise Laroze Prehn/Dropbox/CESS-Santiago/Archive/Gender/Data Analysis")
rm(list=ls())
setwd("/Users/tomrobinson/OneDrive/CESS/Gender/Gender_cheating/")
#fig.path <- "Figures"
#fig.path<- "~/GitHub/Gender_cheating/Figures"
#bd<-"~/GitHub/Gender_cheating/"
fig.path<- "Figures"
# bd<-"C:/Users/Denise Laroze Prehn/Dropbox/CESS-Santiago/Archive/Gender/Data Analysis/"
bd<-"/Users/tomrobinson/OneDrive/CESS/Gender/Gender_cheating/"
v<-"20Jul2018"
#dat<-read.csv("Masterfile_2016_Dec.csv", sep=";")
cdat <- read.dta13("Data/mastern_final2018.dta") # Country comparison
modes<-read.csv("Data/Modes_data.csv")
#################################
### Data Management country data
#################################
#cdat$country<-"UK"
#cdat$country[cdat$chile==1]<-"Chile"
#rus$country<-"Russia"
#### UK and Chile identification of treatment
cdat$treatment <- NA
cdat$treatment[cdat$sujeto %in% c(1:72, 1141:1184)] <- 1 # Baseline
cdat$treatment[cdat$sujeto %in% 677:712] <- 1 # Baseline - Chile
cdat$treatment[cdat$sujeto %in% 321:392] <- 2 # Status
cdat$treatment[cdat$sujeto %in% 629:676] <- 2 # Status - Chile
cdat$treatment[cdat$sujeto %in% 521:628] <- 3 # Shock
cdat$treatment[cdat$sujeto %in% 393:476] <- 4 # Redistribution
cdat$treatment[cdat$sujeto %in% 713:896] <- 5 # non-fixed
cdat$treatment[cdat$country=="Russia"] <- 1 # Baseline
cdat$treatment[cdat$country=="Russia" & cdat$session %in% 112:114] <- 2 # Status - Russia
cdat$treatment[cdat$country=="Russia" & cdat$shock==1] <- 3 # shock - Russia
cdat$treatment[cdat$country=="Russia" & cdat$session==108] <- 4 # Redistribution - Russia
cdat$treatment[cdat$country=="Russia" & cdat$non_fixed==1]<-5
cdat$treatment_lab <- factor(cdat$treatment, labels = c("Baseline",
"Status",
"Shock",
"Redistribution",
"Non-fixed"))
table(cdat$country, cdat$treatment_lab)
cdat$treatment2 <- NA
cdat$treatment2[cdat$sujeto %in% c(1:72, 1141:1184)] <- 1 # Baseline
cdat$treatment2[cdat$sujeto %in% 677:712] <- 1 # Baseline - Chile
cdat$treatment2[cdat$sujeto %in% 321:392 & cdat$highsalary == 0] <- 2 # Status
cdat$treatment2[cdat$sujeto %in% 321:392 & cdat$highsalary == 1] <- 3 # Status
cdat$treatment2[cdat$sujeto %in% 629:676 & cdat$highsalary == 0] <- 2 # Status - Chile
cdat$treatment2[cdat$sujeto %in% 629:676 & cdat$highsalary == 1] <- 3 # Status - Chile
cdat$treatment2[cdat$sujeto %in% 521:628 & cdat$receiveshock == 0] <- 4 # Shock
cdat$treatment2[cdat$sujeto %in% 521:628 & cdat$receiveshock == 1] <- 5 # Shock
cdat$treatment2[cdat$sujeto %in% 393:476] <- 6 # Redistribution
cdat$treatment2[cdat$sujeto %in% 713:896] <- 7# non-fixed UK and Chile
cdat$treatment2[cdat$country=="Russia"] <- 1 # Baseline
cdat$treatment2[cdat$country=="Russia" & cdat$highsalary == 0] <- 2 # Status - Russia
cdat$treatment2[cdat$country=="Russia" & cdat$highsalary == 1] <- 3 # Status - Russia
cdat$treatment2[cdat$country=="Russia" & cdat$receiveshock == 0] <- 4 # Shock - Russia
cdat$treatment2[cdat$country=="Russia" & cdat$receiveshock == 1] <- 5 # Shock - Russia
cdat$treatment2[cdat$country=="Russia" & cdat$session==108] <- 6 # Redistribution - Russia
cdat$treatment2[cdat$country=="Russia" & cdat$non_fixed==1]<-7 # Non-Fixed Russia
cdat$treatment2_lab <- factor(cdat$treatment2, labels = c("Baseline",
"Status (Low)",
"Status (High)",
"Shock (No)",
"Shock (Yes)",
"Redistribution",
"Non-fixed"))
#####  High tax groups
cdat$HighTax  <- as.numeric(apply(cdat[,c("T20","T30", "T40")],1,sum)>0)
##### Gender label
cdat$gender_lab<-cdat$male
################################
### Relevant treatments and Data
################################
# Eliminating irrelevant treatments
cdat<-cdat[complete.cases(cdat$treatment), ]
#cdat<-cdat[cdat$treatment_lab!="Redistribution",]
# Eliminating Modules with 100 audit rate, as the rational decision is that no one cheats
cdat<-cdat[cdat$auditrate!=100, ]
cdat$numberEntered<-cdat$realdie
#################################
### Data Management modes data
#################################
modes$safechoices<-(1-modes$risk.pref.normal)*10
modes$percevaded<-(1-modes$report.rate)
modes$offerdg<-modes$DictGive
modes$country<-ifelse(modes$sample=="Mturk", "USA",
ifelse( modes$sample== "CESS Online Stgo", "Chile", "UK") )
modes$treatment_lab<-as.character(modes$sample)
modes$treatment_lab[modes$sample=="Lab"]<-"Baseline"
#modes$gender_lab[modes$Gender==1]<-"Male"
#modes$gender_lab[modes$Gender==2]<-"Female"
modes$gender_lab[modes$Gender=="M"]<-"Male"
modes$gender_lab[modes$Gender=="F"]<-"Female"
modes$subj_id<- modes$muID
#modes$auditrate[modes$treat==1 & modes$sample=="Lab-DS"]<-0.2
modes<-modes[!(modes$sample == "Lab" & modes$auditrate==0), ]
modes$auditrate[modes$auditrate==0.1]<-10
####################
### Merging
####################
#### Joining datasets
vars<-c("ncorrectret","gender_lab", "safechoices","percevaded", "offerdg", "auditrate",
"country", "treatment_lab" , "subj_id", "taxrate", "numberEntered")
df1<-modes[, vars]
df2<-cdat[, vars]
class(df2$subj_id)<-"character"
df<-rbind(df1, df2)
df<-df[complete.cases(df$gender_lab), ]
rm(df1, df2)
#########################
### Recoding variables
#########################
# Cheating as a dummy
df$cheat<-ifelse(df$percevaded>0, 1, 0)
# Dummy for lab v. online experiments
df$modes<-ifelse(df$treatment_lab %in% c("CESS Online Stgo", "CESS Online UK",  "Mturk",  "Online Lab"), "Online", "Lab")
# Dummy for Die
df$die<-ifelse(is.na(df$numberEntered), "No", "Yes")
#Setting base category for factor
df$country <- factor(df$country, levels = c("UK", "Chile", "Russia", "USA"))
### Defining Performance as a dummy of above country median correct responses
m.cl<-median(df$ncorrectret[df$country=="Chile"], na.rm=T)
m.uk<-median(df$ncorrectret[df$country=="UK"], na.rm = T)
m.ru<-median(df$ncorrectret[df$country=="Russia"], na.rm = T)
m.usa<-median(df$ncorrectret[df$country=="USA"], na.rm = T)
df <- ddply(df, c("subj_id"), mutate,
mean.ncorrectret = mean(ncorrectret, na.rm=T),
perform_high = if (country=="Chile" && mean.ncorrectret>m.cl) "High Performance"
else if (country=="UK" && mean.ncorrectret>m.uk) "High Performance"
else if (country=="Russia" && mean.ncorrectret>m.ru) "High Performance"
else if (country=="USA" && mean.ncorrectret>m.usa) "High Performance"
else "Low Performance"
)
cdat<- ddply(cdat, c("subj_id"), mutate,
mean.ncorrectret = mean(ncorrectret, na.rm=T),
perform_high = if (country=="Chile" && mean.ncorrectret>m.cl) "High Performance"
else if (country=="UK" && mean.ncorrectret>m.uk) "High Performance"
else if (country=="Russia" && mean.ncorrectret>m.ru) "High Performance"  else "Low Performance"
)
###########################
### Subsets of data
###########################
#### Selecting on audit rate = 0 for robustness
df.0<-df[df$auditrate==0, ]
df.cl<-df.0[df.0$country=="Chile", ]
df.uk<-df.0[df.0$country=="UK", ]
df.ru<-df.0[df.0$country=="Russia", ]
df$gender_lab <- factor(df$gender_lab)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
model.main = ~ offerdg + country + gender_lab,#+ country + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
summary(df$percevaded)
summary(df$auditrate)
summary(df$taxrate)
summary(df$modes)
df$modes <- factor(df$modes)
summary(df$modes)
summary(df)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
model.main = ~ country + gender_lab,#+ country + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
model.main = ~ country + gender_lab + perform_high,#+ country + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
summary(df)
df$perform_high <- factor(df$perform_high)
summary(df)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
model.main = ~ country + gender_lab + perform_high,#+ country + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
model.main = ~ country + gender_lab + perform_high,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes + perform_high,
model.main = ~ country + gender_lab + perform_high,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes + perform_high,
model.main = ~ country + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes,
model.main = ~ country + gender_lab + perform_high,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + modes + perform_high,
model.main = ~ country + gender_lab,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + perform_high,
model.main = ~ country + gender_lab + modes,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2)
F1 <- FindIt(model.treat = percevaded ~ auditrate + taxrate + perform_high,
model.main = ~ country + gender_lab + modes,
data = df,
type = "continuous",
treat.type = "multiple",
nway = 2,
search.lambdas = FALSE,
lambdas = c(-8.6345,-8.6295))
F1_pred <- predict(F1)
plot(F1_pred)
View(F1_pred)
View(F1_pred$data)
F2 <- FindIt(model.treat = percevaded ~ auditrate,
model.main = ~ country + gender_lab + modes,
model.int = ~ country + gender_lab + modes,
data = df,
type = "continuous",
treat.type = "single")
F2 <- FindIt(model.treat = percevaded ~ auditrate,
model.main = ~ country + gender_lab + modes,
model.int = ~ country + gender_lab + modes,
data = df,
type = "continuous",
treat.type = "single",
search.lambdas = FALSE,
lambdas = c(-9.7285,-9.7235))
F2_pred <- predict(F2)
plot(F2_pred)
View(F2_pred)
F2 <- FindIt(model.treat = percevaded ~ auditrate + taxrate,
model.main = ~ country + gender_lab + modes,
model.int = ~ country + gender_lab + modes,
data = df,
type = "continuous",
treat.type = "single")
summary(F1_pred)
summary(F1)
df_het <- df
df_het <- df
df_het$gender_lab <- factor(df_het$gender_lab)
df_het$modes <- factor(df_het$modes)
df_het$perform_high <- factor(df_het$perform_high)
colnames(df_het)
summary(df$modes)
df_het <- df[df$modes = "Lab",]
df_het <- df[df$modes == "Lab",]
summary(df$auditrate)
df$auditrate
F2 <- FindIt(model.treat = percevaded ~ auditrate,
model.main = ~ country + gender_lab + modes,
model.int = ~ country + gender_lab + modes,
data = df_het,
type = "continuous",
treat.type = "single")
F1 <- FindIt(model.treat = percevaded ~ deductrate,
model.main = ~ country + gender_lab + offerdg + perform_high,
model.int = ~ gender_lab
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
F1 <- FindIt(model.treat = percevaded ~ deductrate,
model.main = ~ country + gender_lab + offerdg + perform_high,
model.int = ~ gender_lab
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
F1 <- FindIt(model.treat = percevaded ~ deductrate,
model.main = ~ country + gender_lab + offerdg + perform_high,
model.int = ~ gender_lab
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
F1 <- FindIt(model.treat = percevaded ~ deductrate,
model.main = ~ country + gender_lab + offerdg + perform_high,
model.int = ~ gender_lab,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
F1 <- FindIt(model.treat = percevaded ~ taxrate,
model.main = ~ country + gender_lab + offerdg + perform_high,
model.int = ~ gender_lab,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
df_het$taxrate
F1 <- FindIt(model.treat = percevaded ~ taxrate,
model.main = ~ country + gender_lab + offerdg,
model.int = ~ gender_lab,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
F1 <- FindIt(model.treat = percevaded ~ taxrate,
model.main = ~ country + gender_lab  + perform_high,
model.int = ~ gender_lab,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
df_het <- df[df$modes == "Lab",]
df_het$gender_lab <- factor(df_het$gender_lab)
df_het$modes <- factor(df_het$modes)
df_het$perform_high <- factor(df_het$perform_high)
F1 <- FindIt(model.treat = percevaded ~ taxrate,
model.main = ~ country + gender_lab + offerdg + perform_high,
model.int = ~ gender_lab,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
F1 <- FindIt(model.treat = percevaded ~ taxrate,
model.main = ~ country + offerdg + perform_high,
model.int = ~ gender_lab,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
F1 <- FindIt(model.treat = percevaded ~ taxrate,
model.main = ~ gender_lab + offerdg + perform_high,
model.int = ~ gender_lab,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
F1 <- FindIt(model.treat = percevaded ~ taxrate,
model.main = ~ country  + offerdg + perform_high,
model.int = ~ country,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
F1 <- FindIt(model.treat = percevaded ~ offerdg,
model.main = ~ gender_lab + offerdg + perform_high,
model.int = ~ gender_lab,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
df_het$percevaded
colnames(def_het)
colnames(df_het)
F1 <- FindIt(model.treat = percevaded ~ taxrate,
model.main = ~ gender_lab + offerdg + perform_high,
model.int = ~ gender_lab,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
F1 <- FindIt(model.treat = percevaded ~ taxrate,
model.main = ~ gender_lab + offerdg + perform_high,
model.int = ~ gender_lab + country,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
F1 <- FindIt(model.treat = percevaded ~ taxrate,
model.main = ~ gender_lab + offerdg + perform_high + country,
model.int = ~ gender_lab + country,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
View(df_het)
View(df_het[df_het$auditrate == 0,])
df_het <- df[df$modes == "Lab",]
df_het$gender_lab <- as.factor(df_het$gender_lab)
df_het$modes <- as.factor(df_het$modes)
df_het$perform_high <- as.factor(df_het$perform_high)
F1 <- FindIt(model.treat = percevaded ~ taxrate,
model.main = ~ gender_lab + offerdg + perform_high,
model.int = ~ gender_lab,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
F1 <- FindIt(model.treat = percevaded ~ taxrate,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
F1 <- FindIt(model.treat = percevaded ~ taxrate,
model.int = ~ gender_lab,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
df_het <- df[df$modes == "Lab",]
df_het$gender_lab <- as.factor(df_het$gender_lab)
df_het$modes <- as.factor(df_het$modes)
df_het$perform_high <- as.factor(df_het$perform_high)
F1 <- FindIt(model.treat = percevaded ~ taxrate,
model.int = ~ gender_lab,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
F1 <- FindIt(model.treat = percevaded ~ taxrate,
model.int = ~ gender_lab + country,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
df_het$taxrate
summary(df$taxrate)
F1 <- FindIt(model.treat = percevaded ~ taxrate,
model.int = ~ country,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
F1 <- FindIt(model.treat = percevaded ~ taxrate,
model.int = ~ country,
data = df_het[df_het$auditrate == 0,],
type = "continuous",
treat.type = "single")
